PROCEDURE FOR HOMING

1. CLUTCH FIRST, THEN LINEARS



CLUTCH MOTOR HOMING

0. ENSURE THE PEDAL ASSIST ISN'T ACTING, ROTATE MOTOR ONE FULL REVOLUTION AND WAIT FOR RISING EDGE OF ENGAGED SENSOR THEN STOP THE MOTOR.
    E --> ISSUE ERROR IF COMPLETED 1.25 REVS AND DO NOT SEE SENSOR TRIGGER ON/OFF
    E --> motor stalls for longer than 250ms

1. ZERO THE ENCODER POSITION JUST FOR GOOD MEASURE

10. ROTATE MOTOR IN FWD DIR UNTIL THE "DISENGAGED" SENSOR IS TRIGGERED, THEN STOP THE MOTOR.
    E --> motor completes full rev without triggereding sensor
    E --> motor stalls for longer than 250ms

12. REV DIR UNTIL SENSOR IS UNTRIGGERED THEN STOP
    E --> motor completes half rev without untriggereding sensor
    E --> motor stalls for longer than 250ms


14. FWD AGAIN AT CREEP SPEED TO TRIGGER THE SENSOR, RECORD POSITION UPON TRIGGERING THEN STOP MOTOR
    E --> motor completes half rev without untriggereding sensor
    E --> motor stalls for longer than 250ms

15. ADJUST ENCODER POSITION USING DIFF BETWEEN CURRENT POSITION AND RECORDED POSITION AND ADD IT TO THE DESIRED POSITION READING (CFG PARAM) WITH CALIBRATION OFFSET (CALIBRATION PARAM)


20. MOTOR MOVES THE ENGANGED POSITION (@ 0.00 REV - CFG PARAM)


TASK: MOVE CLUTCH TO DISENGAGED POSITION

1. MOVE MOTOR TO PEDAL-ASSIST DISENGAGE POSITOIN (CFG PARAM)

2. IF DISENGAGED SENSOR IS TRIGGERED, THEN SKIP AHEAD TO 10.

5. MOVE AT 


LINEAR MOTORS HOMING

1. VERIFY CLUTCH IS HOMED AND IN "ENGAGED" POSITION

2. PERFORM "MOVE CLUTCH TO DISENGAGED POSITION" TASK

3. HOME TO HARD STOP